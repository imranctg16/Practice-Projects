<?php
namespace App\Http\Controllers; use App\Models\Post; use App\Http\Resources\PostResource; use Illuminate\Http\Request;
class PostController extends Controller { public function index(){ return PostResource::collection(Post::with('user')->latest()->paginate(10)); } public function show(Post $post){ $post->load(['user','comments']); return new PostResource($post); } public function store(Request $request){ $data=$request->validate(['title'=>'required|string|max:255','body'=>'required|string']); $userId=\App\Models\User::query()->value('id') ?? \App\Models\User::factory()->create()->id; $post=Post::create(['user_id'=>$userId]+$data); return new PostResource($post->load(['user','comments'])); } public function update(Request $request, Post $post){ $data=$request->validate(['title'=>'sometimes|string|max:255','body'=>'sometimes|string']); $post->update($data); return new PostResource($post->fresh()->load(['user','comments'])); } public function destroy(Post $post){ $post->delete(); return response()->noContent(); } }
